Problems:
- loops in graph
- possibility to change plan on-the-fly without locking (describe it in manual)
